# Wiring Up AWS Accounts


This solution requires at least one AWS connection in order to scan your environment. For 
your convenience we offer 3 options to instrument your accounts with our platform.

Choose your preferred installation method:

### Option 1: CloudFormation (Recommended for AWS Users)
One-click deployment via AWS Console or CLI.
### Option 2: Terraform (Recommended for IaC Users)
Infrastructure as code for version control and automation.
### Option 3: Manual Setup (Testing/Development)
Step-by-step AWS Console instructions.

## Option 1: CloudFormation Stack
### One-Click Deploy

1. Download the template (see CloudFormation artifact below)
2. Go to AWS Console → CloudFormation → Create Stack
3. Upload resonant-iam-role.yaml
4. Fill in parameters:
   * ExternalId: (Generated by Resonant - see app)
   * RoleName: ResonantReadOnlyRole (or customize)
5. Review and create stack

**CLI Deploy**
```bash
aws cloudformation create-stack \
--stack-name resonant-integration \
--template-body file://resonant-iam-role.yaml \
--parameters \
ParameterKey=ExternalId,ParameterValue=YOUR_EXTERNAL_ID \
ParameterKey=ResonantAwsAccountId,ParameterValue=123456789012 \
--capabilities CAPABILITY_NAMED_IAM
```
**Get Role ARN**
```bash
bashaws cloudformation describe-stacks \
--stack-name resonant-integration \
--query 'Stacks[0].Outputs[?OutputKey==`RoleArn`].OutputValue' \
--output text
```

## Option 2: Terraform Deploy

### Prerequisites
```bash
terraform >= 1.0
aws provider >= 5.0
```

### Deploy
```bash
# Download the Terraform module (see artifact below)
cd resonant-terraform

# Initialize
terraform init

# Set variables
export TF_VAR_external_id="your-external-id-from-resonant"
export TF_VAR_resonant_aws_account_id="123456789012"

# Plan and apply
terraform plan
terraform apply 
```

### Get Role ARN
```bash
terraform output role_arn
```

## Option 3: Manual Setup (Console)

### Step 1: Create IAM Policy

1. Go to IAM → Policies → Create Policy
2. Switch to JSON tab
3. Paste the policy JSON (see below)
4. Name it: ResonantReadOnlyPolicy
5. Click Create Policy

### Step 2: Create IAM Role

1. Go to IAM → Roles → Create Role
2. Select AWS Account as trusted entity
3. Choose Another AWS account
4. Enter Resonant's Account ID: 123456789012 (placeholder - will be provided)
5. Check Require external ID
6. Enter your External ID from Resonant app
7. Click Next
8. Attach the ResonantReadOnlyPolicy you created
9. Name the role: ResonantReadOnlyRole
10. Click Create Role

### Step 3: Copy Role ARN

1. Go to the role you just created
2. Copy the Role ARN (format: arn:aws:iam::123456789012:role/ResonantReadOnlyRole)
3. Paste this into Resonant app

## IAM Policy Permissions
The read-only policy grants access to:
### EC2 (Compute)
* Describe instances, volumes, snapshots, security groups
* Read tags

### S3 (Storage)
* List buckets
* Get bucket tags, location, versioning, encryption
* NO access to bucket contents

### RDS (Database)
* Describe DB instances, clusters, snapshots
* Read tags

### Lambda (Functions)
* List functions
* Get function configuration and tags

### Additional Services (Future)
* ECS, EKS, DynamoDB, CloudFront, ElastiCache
* All read-only, no modification permissions


## Testing Your Setup
### Verify Role Assumption (AWS CLI)
```bash
# Test assuming the role
aws sts assume-role \
--role-arn "arn:aws:iam::YOUR_ACCOUNT_ID:role/ResonantReadOnlyRole" \
--role-session-name "resonant-test" \
--external-id "YOUR_EXTERNAL_ID"
```
Success response means your role is configured correctly!

### Test in Resonant
1. Go to Resonant → AWS Accounts → Add Account
2. Enter your AWS Account ID
3. Enter the Role ARN you created
4. Click Test Connection
5. If successful, click Save & Scan